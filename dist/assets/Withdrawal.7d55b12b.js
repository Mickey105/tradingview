import{P,R as M,_ as S,r as g,b as v,o as l,c,e as s,F as y,t as a,d as b,i as h,w as C,g as _,v as f,h as W,l as A,f as m,B,C as F,Q as x,y as E,V as I,W as O,X as $}from"./index.8b30e6a1.js";import{g as H,f as D}from"./getRegularNumber.a168e36c.js";import{W as N}from"./WalletHistory.4d4db630.js";import{W as L}from"./WalletDepositSepaFialModal.5274143e.js";import{e as U}from"./errorHundle.1358d0d5.js";import{a as R}from"./mixin.9e072d4b.js";import{S as T,_ as q}from"./SelectAdvanced.4865e5c6.js";import{_ as V}from"./check-circle.5148da9f.js";import{S as X}from"./SecurityNoticeModal.0dee1ea1.js";import{I as j}from"./InfoModal.fb2c8c4b.js";import"./long-arrow-right.6b4bc820.js";const z={name:"WalletWithdrawalCryptoAddress",components:{SelectAdvanced:T},mixins:[P,R,H],props:{ticker:{type:String,require:!0,default:""}},emits:["close"],data(){return{confirmationCode:"",confirmEmailTimer:0,lastWithdrawalAdresses:{},destinationTag:"",addrToPayMe:"",amountToPayMe:"",payout_form_view:"pending",addressInputFocused:!1,sms_code:null,blockchainCurrency:null}},computed:{...M({balance:"core/balance",coins:"core/coins"}),blockChains(){let e={};return this.currentBlockchainList.map(t=>{e[t]={id:t}}),e},currentBlockchainList(){return this.coin.blockchain_list},currentWithdrawText(){switch(["BNB"].includes(this.ticker)?this.ticker:this.blockchainCurrency){case"ETH":return"sendOnlyErc20";case"BNB":return"sendOnlyBep20";case"MMETA":return"sendOnlyBep20";case"BSC":return"sendOnlyBep20";case"TRX":return"sendOnlyTrc20";default:return"sendOnlyErc20"}},lastaddressesexists(){return this.lastWithdrawalAdresses[this.ticker]?this.lastWithdrawalAdresses[this.ticker].length>0:!1},coin(){return this.coins[this.ticker]},finalAmount(){return this.amountToPayMe>=this.coin.limits.withdrawal.min?this.amountToPayMe-this.selectedBlockchainCurrencyWithdrawal:0},selectedBlockchainCurrencyWithdrawal(){let e=Object.values(this.coin.fee.withdrawal.address);return e.length>1?this.coin.fee.withdrawal.address[`${this.blockchainCurrency}`]:e.length===1?this.coin.fee.withdrawal.address[`${this.ticker}`]||this.coin.fee.withdrawal.address[`${this.blockchainCurrency}`]:0}},mounted(){this.getLastCryptoAdresses(),this.currentBlockchainList&&this.currentBlockchainList.length&&(this.blockchainCurrency=this.currentBlockchainList[0])},methods:{cancelWithdrawal(){this.$http.post("withdrawal/cancel-withdrawal-request",{withdrawal_request_id:this.requestId}).then(()=>{this.payout_form_view="pending"})},sendConfirmationCode(){this.$http.post("withdrawal/confirm-withdrawal-request",{confirmation_token:this.confirmationCode}).then(()=>{this.payout_form_view="success"}).catch(()=>{this.$notify({type:"error",title:"",text:this.$t("common.invalid_code")})})},runConfirmEmailTimer(){if(this.confirmEmailTimer>0)return;this.confirmEmailTimer=180;const e=setInterval(()=>{this.confirmEmailTimer--,this.confirmEmailTimer<0&&clearInterval(e)},1e3)},resendCode(){this.$http.post("withdrawal/resend-withdrawal-request",{withdrawal_request_id:this.requestId}).then(()=>{this.runConfirmEmailTimer()})},setMax(){this.amountToPayMe=this.balance[this.ticker].actual},blockchainChoose(e){this.blockchainCurrency=e},toFxd(e,t){return e?parseFloat(e).toFixed(t):0},setErrorMessage(e){e&&this.$notify({title:this.$t("common.error"),type:"error",text:`${e}`})},validateXrpAddr(){["XRP","EOS"].includes(this.ticker)&&this.localConfig[this.ticker.toLowerCase()+"_wallet"]===this.addrToPayMe&&(this.addrToPayMe="")},setAddress(e){this.addrToPayMe=e},payMe(){let e=this;if(this.amountToPayMe&&!isNaN(this.amountToPayMe)&&this.getFixedDecimal(this.amountToPayMe)>0){this.setErrorMessage("");let t={amount:this.getFixedDecimal(this.amountToPayMe),currency:this.ticker,destination:this.addrToPayMe};this.blockchainCurrency&&(t.blockchain_currency=this.blockchainCurrency),this.ticker==="XRP"&&(t.data={destination_tag:parseInt(this.destinationTag)}),this.ticker==="EOS"&&(t.data={memo:this.destinationTag}),this.sms_code&&(t.sms_code=this.sms_code),this.$http.post("wallet_withdrawal/",t).then(n=>{this.amountToPayMe="",this.addrToPayMe="",setTimeout(function(){e.$modal.close()},3500),this.payout_form_view="confirm_by_email",this.confirmationCode="",this.runConfirmEmailTimer(),this.requestId=n.data.id},n=>{U.parse(n,this,["bad_min_amount","bad_max_amount","not_enough_funds","invalid_address","currency_not_found","wrong_data","payouts_freezed","out_of_limit"])})}else this.setErrorMessage(this.$t("common.enter_valid_sum"))},getLastCryptoAdresses(){this.$http.get("getlastaddresses/").then(e=>{for(let t in e.data)this.lastWithdrawalAdresses[e.data[t].currency]=e.data[t].addresses},e=>{console.error(e.data)})},verifiedPhone(e){this.sms_code=e,this.payout_form_view="pending",this.payMe()},changeAmount(e){this[e]=this[e].replace(/,/g,".")}}},d=e=>(B("data-v-9779b574"),e=e(),F(),e),J={role:"document"},G={key:0,class:"formField"},K={class:"formField"},Q={class:"formField__readonly"},Z={class:"formField"},Y={class:"formField__readonly"},ee={class:"formField"},te={class:"stake-field_input_w"},se=d(()=>s("span",null,"max",-1)),ie=[se],ae={class:"formField"},oe={key:0,style:{"text-align":"center",margin:"20px auto 0px auto",padding:"5px","border-radius":"5px",color:"#2a3040"}},re={class:"title"},ne=["onClick"],le={key:1,class:"title mt-2"},ce={key:3,style:{"font-size":"12px","text-align":"center","margin-top":"10px"}},de={class:"text-danger"},he={class:"withdrawal__minMax"},ue=d(()=>s("div",{class:"withdrawal__minMax-blockLeft"},[s("img",{src:q,width:"30",height:"30"})],-1)),me={class:"withdrawal__minMax-blockCenter"},_e=d(()=>s("br",null,null,-1)),fe=d(()=>s("br",null,null,-1)),pe=d(()=>s("br",null,null,-1)),we=d(()=>s("br",null,null,-1)),ye={key:0},ge={class:"withdrawal__minMax-blockRight"},be=d(()=>s("br",null,null,-1)),ke={class:"receivedBlock"},ve={class:"withdrawal__btnWrapper"},Ce=["disabled"],Pe=d(()=>s("div",{class:"withdrawal__btnIcon"},null,-1)),Me={key:4,class:"text-center text-danger"},Se={style:{"text-align":"center",color:"#777777","font-size":"14px","margin-bottom":"3px","font-weight":"600","text-transform":"uppercase"},class:"text-danger"},Te=d(()=>s("div",{class:"text-center"},[s("img",{class:"inline-block",src:V,width:"20",alt:""})],-1)),We={style:{"text-align":"center"}},Ae=d(()=>s("br",null,null,-1)),Be={style:{"text-align":"center","font-weight":"600"}},Fe=d(()=>s("br",null,null,-1)),xe={class:"withdrawal__btnWrapper"},Ee={class:"formField"},Ie={key:0,class:"logIn__descr mb-4"},Oe={class:"withdrawal__btn mx-auto mb-4 w-[292px]",type:"submit"};function $e(e,t,n,u,o,i){const p=g("select-advanced"),w=v("numeric"),k=v("pattern");return l(),c("div",J,[s("div",null,[o.payout_form_view==="pending"?(l(),c(y,{key:0},[i.currentBlockchainList&&i.currentBlockchainList.length>1?(l(),c("div",G,[s("label",null,a(e.$t("common.blockchain_currency")),1),b(p,{items:i.blockChains,image:!1,"all-coins":e.coins,onSelect:i.blockchainChoose},null,8,["items","all-coins","onSelect"])])):h("",!0),s("div",K,[s("label",null,a(e.$t("common.lost_balance")),1),s("div",Q,a(i.toFxd(i.coin.actual,8)),1)]),s("div",Z,[s("label",null,a(e.$t("common.balanceafterwithdrawal")),1),s("div",Y,a(i.toFxd(i.coin.actual-(parseFloat(o.amountToPayMe)||0),8)<0?0:i.toFxd(i.coin.actual-(parseFloat(o.amountToPayMe)||0),8)),1)]),s("form",{onSubmit:t[8]||(t[8]=C((...r)=>i.payMe&&i.payMe(...r),["prevent"]))},[s("div",ee,[s("label",null,a(e.$t("common.amount_sum")),1),s("div",te,[_(s("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>o.amountToPayMe=r),fractional:"8",class:"formField__input",type:"text",maxlength:"16",autocomplete:"off",name:"amountToPayMe",onInput:t[1]||(t[1]=r=>i.changeAmount("amountToPayMe"))},null,544),[[f,o.amountToPayMe],[w,void 0,void 0,{number:!0,decimal:!0,fractional:!0}]]),s("div",{class:"stake-field_input-max",onClick:t[2]||(t[2]=(...r)=>i.setMax&&i.setMax(...r))},ie)])]),s("div",ae,[s("label",null,a(e.$t("common.addressto")),1),_(s("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>o.addrToPayMe=r),class:W(["formField__input",{"not-empty":o.addrToPayMe.length}]),type:"text",placeholder:"",autocomplete:"off",onFocus:t[4]||(t[4]=r=>o.addressInputFocused=!0),onBlur:t[5]||(t[5]=r=>o.addressInputFocused=!1),onChange:t[6]||(t[6]=(...r)=>i.validateXrpAddr&&i.validateXrpAddr(...r))},null,34),[[f,o.addrToPayMe],[k,/^[a-zA-Z_0-9\-]*$/]])]),i.lastaddressesexists?(l(),c("div",oe,[s("p",re,a(e.$t("common.lastaddresses")),1),(l(!0),c(y,null,A(o.lastWithdrawalAdresses[n.ticker],r=>(l(),c("button",{key:r,type:"button",class:"width-button-link",style:{"font-size":"11px",margin:"0px auto",color:"#6868f1","text-decoration":"underline",display:"block"},onClick:Qe=>i.setAddress(r)},a(r),9,ne))),128))])):h("",!0),["XRP","EOS"].includes(n.ticker)?(l(),c("p",le,a(e.$t("common."+n.ticker+".addressTag")),1)):h("",!0),["XRP","EOS"].includes(n.ticker)?_((l(),c("input",{key:2,"onUpdate:modelValue":t[7]||(t[7]=r=>o.destinationTag=r),class:"form-control",type:"text",autocomplete:"off",name:"destinationTag",style:{color:"lightslategrey","font-weight":"400",height:"42px","font-size":"11px"}},null,512)),[[f,o.destinationTag]]):h("",!0),["USDT","BNB","MMETA"].includes(n.ticker)?(l(),c("p",ce,[s("span",de,a(e.$t(`common.${i.currentWithdrawText}`)),1)])):h("",!0),s("div",he,[ue,s("div",me,[m(a(e.$t("common.minamount"))+": ",1),_e,s("strong",null,a(e.addSpace(i.coin.limits.withdrawal.min))+" "+a(n.ticker),1),fe,pe,m(" "+a(e.$t("common.second_table_withdraw_fee"))+": ",1),we,i.selectedBlockchainCurrencyWithdrawal?(l(),c("strong",ye,a(i.toFxd(e.getRegularNumber(i.selectedBlockchainCurrencyWithdrawal),8))+" "+a(n.ticker),1)):h("",!0)]),s("div",ge,[m(a(e.$t("common.maxamount"))+": ",1),be,s("strong",null,a(e.addSpace(i.coin.limits.withdrawal.max))+" "+a(n.ticker),1)])]),s("div",ke,[s("label",null,a(e.$t("common.amounttowww")),1),s("div",null,a(parseFloat(i.toFxd(e.getRegularNumber(i.finalAmount),8))<0?0:e.addSpaceFixDecimal(i.finalAmount)),1)]),s("div",ve,[s("button",{type:"submit",disabled:!o.addrToPayMe.length||!o.amountToPayMe||i.coin.disable_withdrawals,class:"withdrawal__btn"},[m(a(e.$t("common.withdrawal"))+" ",1),Pe],8,Ce)]),i.coin.disable_withdrawals?(l(),c("p",Me,a(e.$t("common.withdrawals_disabled")),1)):h("",!0),s("p",Se,a(e.$t("common.h24")),1)],32)],64)):h("",!0),o.payout_form_view==="success"?(l(),c(y,{key:1},[Te,s("h3",We,a(e.$t("common.success")),1),Ae,s("p",Be,a(e.$t("common.withdrawalprocessing")),1),Fe,s("div",xe,[s("div",{class:"big_btn",onClick:t[9]||(t[9]=r=>e.$router.go())},a(e.$t("common.continue")),1)])],64)):h("",!0),o.payout_form_view==="confirm_by_email"?(l(),c("form",{key:2,onSubmit:t[13]||(t[13]=C((...r)=>i.sendConfirmationCode&&i.sendConfirmationCode(...r),["prevent"]))},[s("div",Ee,[s("label",null,a(e.$t("common.email_sent")),1),_(s("input",{"onUpdate:modelValue":t[10]||(t[10]=r=>o.confirmationCode=r),required:"",class:"formField__input",type:"text"},null,512),[[f,o.confirmationCode]])]),o.confirmEmailTimer>0?(l(),c("div",Ie,[s("strong",null,a(e.$t("common.getCode")),1),m(" "+a(e.$t("common.againAfter",{n:o.confirmEmailTimer})),1)])):(l(),c("button",{key:1,class:"withdrawal__btn withdrawal__btn_yellow mx-auto mb-4 w-[292px]",type:"button",onClick:t[11]||(t[11]=(...r)=>i.resendCode&&i.resendCode(...r))},a(e.$t("common.resend")),1)),s("button",Oe,a(e.$t("common.confirm")),1),s("button",{class:"withdrawal__btn withdrawal__btn_red w-[292px] mx-auto mb-4",type:"button",onClick:t[12]||(t[12]=(...r)=>i.cancelWithdrawal&&i.cancelWithdrawal(...r))},a(e.$t("common.cancel_withdrawal")),1)],32)):h("",!0)])])}var He=S(z,[["render",$e],["__scopeId","data-v-9779b574"]]);const De={name:"WalletWithdrawall",metaInfo(){return{title:this.$t("pages.wallet"),meta:[{name:"description",content:`${this.localConfig.project_title} ${this.$t("pages.walletDescription")}`}]}},components:{SelectAdvanced:T,WalletHistory:N},mixins:[P,x],data(){var e,t;return{selectedCoin:"",openedAction:"",selectedDefault:(t=(e=this.$route)==null?void 0:e.params)==null?void 0:t.walletitem,openedActionProperties:{},payout_form_view:"pending",errorMSGwithADVCASH:"",currencyWWWwithINTERKASSA:"USDT",curPage:1,txscount:0,amountOnPage:10,amountOfPages:1,timers:[],resend_loader:{},floor10:D}},computed:{...M({coins:"core/coins",profile:"core/profile",isConnectedSocket:"isConnectedSocket",wsUserIsAuthenticated:"wsUserIsAuthenticated",user_notification:"core/user_notification",walletWithdrawalHistory:"core/walletWithdrawalHistory",reconnectError:"reconnectError",lockedBalance:"core/lockedBalance"}),filteredCoins(){return Object.fromEntries(Object.entries(this.coins).filter(([,e])=>e.active&&!e.disable_all))}},watch:{isConnectedSocket(e){e&&localStorage.getItem("token")&&this.$store.dispatch("sendWSMessage",JSON.stringify({token:localStorage.getItem("token")}))},wsUserIsAuthenticated(e){e&&(this.getBalance(),this.getLockedBalance(),this.getWalletHistory())},user_notification(e){e.length&&this.$modal.show(j,{},{adaptive:!0,height:"auto",scrollable:!0,width:500})},reconnectError(e){e&&(this.updateWalletHistory(this.curPage,this.amountOnPage),this.updateBalance())}},async mounted(){var e,t;await Promise.all([this.$store.dispatch("core/getCoinsLimits"),this.loadWallets(),this.$store.dispatch("core/getUserNotifications")]),this.showSecurityNotice(),this.isConnectedSocket&&(localStorage.getItem("token")&&this.$store.dispatch("sendWSMessage",JSON.stringify({token:localStorage.getItem("token")})),this.wsUserIsAuthenticated&&(this.getBalance(),this.getLockedBalance(),this.getWalletHistory())),this.cryptoWithdrawalClickHandler((t=(e=this.$route)==null?void 0:e.params)==null?void 0:t.walletitem)},beforeUnmount(){for(this.unsubscribeWsData();this.timers.length;)clearTimeout(this.timers.shift())},methods:{coinChoose(e){this.$route.params.walletitem!==e&&this.$router.push({name:"wallet-withdrawal",params:{walletitem:e}})},blockchainCurrencyByCoin(e){return e.blockchain_list?e.blockchain_list.map(t=>({code:t,name:t})):[]},formatingCommission(e){const t=Object.values(e);return t.length>1?`${Math.min(...t)} - ${Math.max(...t)}`:t.length===1?`${t[0]}`:"0"},formatingBalanceAndOrder(e){return e!==0?e.toFixed(8):e.toFixed()},showLockedBalance(e){return this.lockedBalance[e]},getCoinWithdrawalFee(e){return e.fee.withdrawal[this.$config.currentWithdrawCardPaySystem]},getCoinDepositFee(e){return e.fee.deposit[this.$config.currentTopUpCardPaySystem]},sepaDepositButtonHandler(e){this.$modal.show(L,{currency:e},{adaptive:!0,height:"auto",scrollable:!0,width:500})},cryptoWithdrawalClickHandler(e){this.openedAction=He,this.openedActionProperties={ticker:e}},fromPagetoLimits(e){let t=this.amountOnPage,n=t*(e-1);return{limit:t,offset:n,pageNum:e}},getPageCount(){return this.amountOfPages},changePage(e){this.curPage=e},handlePagination(e){this.changePage(e),this.reconnectError?this.updateWalletHistory(e,this.amountOnPage):this.getWalletHistory(e,this.amountOnPage,!0)},getPrettyDate(e){let t=new Date;return t.setTime(parseInt(e)*1e3),t.toLocaleString("ru-RU")},updateTable(){this.getWalletHistory(this.curPage,this.amountOnPage,!0),this.reconnectError&&this.updateWalletHistory(this.curPage)},sendSocketMessage(e,t,n,u){let o={command:e};t&&Object.keys(t)&&(o.params=t),u&&(o.token=localStorage.getItem("token")||null),n&&(o.params.pair_name=`${this.currentPair[0]}-${this.currentPair[1]}`),this.$store.dispatch("sendWSMessage",JSON.stringify(o))},getBalance(){this.sendSocketMessage("add_balance",{},!1,!0)},getLockedBalance(){this.sendSocketMessage("add_locked_balance",{},!1,!0)},updateBalance(){this.$store.dispatch("core/getBalance")},updateWalletHistory(e,t){let n=t*(e-1);this.$store.dispatch("core/getWalletWithdrawalHistory",{limit:t,offset:n,page:e,fc:()=>{this.changePage(e)}})},getWalletHistory(e,t){const n="add_wallet_withdrawals_history";this.reconnectError||this.sendSocketMessage(n,{limit:t||10,page:e||1},!1,!0)},unsubscribeWsData(){this.sendSocketMessage("del_balance",{},!1,!0),this.sendSocketMessage("del_wallet_withdrawals_history",{},!1,!0)},async loadWallets(){await this.$http.post("getwallets/",{}).then(e=>{e.data.forEach(t=>{this.coins[t.currency]||(this.coins[t.currency]={}),this.coins[t.currency].address||(this.coins[t.currency].address=t),Array.isArray(this.coins[t.currency].address)&&!this.coins[t.currency].address.find(n=>n.address===t.address)&&(this.coins[t.currency].address=[...this.coins[t.currency].address,t]),typeof this.coins[t.currency].address=="object"&&!Array.isArray(this.coins[t.currency].address)&&this.coins[t.currency].address!==null&&this.coins[t.currency].address.address!==t.address&&(this.coins[t.currency].address=[this.coins[t.currency].address,t])})})},showSecurityNoticeModal(){this.$modal.show(X,{},{adaptive:!0,height:"auto",scrollable:!0,width:500})},showSecurityNotice(){localStorage.getItem("show_security_notice")!="OFF"&&this.$http.post("check2fa/").then(t=>{const n=t.data==="OFF",u=!this.profile.withdrawals_sms_confirmation;n&&u&&this.showSecurityNoticeModal()})},formatAmount(e){return parseFloat(e)>0?e:0}}},Ne={class:"container-lg"},Le={class:"deposit xl:grid grid-cols-5 gap-4"},Ue={class:"col-span-2"},Re={class:"plate"},qe={class:"wallet__panel"},Ve={class:"selector"},Xe={class:"col-span-3"},je={class:"plate"},ze={class:"wallet__title wallet__title--single"},Je={class:"plate"},Ge={class:"wallet__title wallet__title--table"};function Ke(e,t,n,u,o,i){const p=g("SelectAdvanced"),w=g("WalletHistory");return l(),c("div",null,[s("div",Ne,[s("div",Le,[s("div",Ue,[s("div",Re,[s("div",{class:"plate-back",onClick:t[0]||(t[0]=k=>e.$router.push({name:"wallet"}))},a(e.$t("common.withdrawal")),1),s("div",qe,[s("div",Ve,[s("label",null,a(e.$t("common.select_coin")),1),b(p,{"total-title":e.$t("common.allbalance"),items:i.filteredCoins,"selected-default":o.selectedDefault,image:!0,"all-coins":e.coins,onSelect:i.coinChoose},null,8,["total-title","items","selected-default","all-coins","onSelect"])]),(l(),E($(o.openedAction),I(O(o.openedActionProperties)),null,16))])])]),s("div",Xe,[s("div",je,[s("div",ze,a(e.$t("common.walletwithdrawal_title")),1),s("div",null,a(e.$t("common.walletwithdrawal_text")),1)]),s("div",Je,[s("div",Ge,a(e.$t("common.walletwithdrawal")),1),b(w,{wallethistory:e.walletWithdrawalHistory.list,"cur-page":e.walletWithdrawalHistory.currentPage,"page-count":e.walletWithdrawalHistory.totalPages,"get-pretty-date":i.getPrettyDate,"handle-pagination":i.handlePagination,"update-table":i.updateTable,onPageChange:i.changePage},null,8,["wallethistory","cur-page","page-count","get-pretty-date","handle-pagination","update-table","onPageChange"])])])])])])}var ct=S(De,[["render",Ke],["__scopeId","data-v-9b484cce"]]);export{ct as default};
